<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <title>robap/php-router @ GitHub</title>
        <link href="prettify/prettify.css" type="text/css" rel="stylesheet" />
        <script type="text/javascript" src="prettify/prettify.js"></script>
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
        <script type="text/javascript">
          $(document).ready(function() {
            $('pre').addClass('prettyprint')
            prettyPrint()
          });
        </script>
        <style type="text/css">
            body {
                margin-top: 1.0em;
                background-color: #fff;
                font-family: "helvetica";
                color: #555;
            }
            #container {
                margin: 0 auto;
                width: 700px;
            }
            h1 { font-size: 3.8em; color: #db7c1f; margin-bottom: 3px; }
            h1 .small { font-size: 0.4em; }
            h1 a { text-decoration: none }
            h2 { font-size: 1.5em; color: #db7c1f; }
            h3 { text-align: center; color: #db7c1f; }
            a { color: #db7c1f; }
            .description { font-size: 1.2em; margin-bottom: 30px; margin-top: 30px; font-style: italic;}
            .download { float: right; }
            pre { background: #e0e0e0; color: #000; padding: 15px;}
            hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
            .footer { text-align:center; padding-top:30px; font-style: italic; }
        </style>
    </head>
    <body>
    <a href="http://github.com/robap/php-router">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" />
    </a>

    <div id="container">
        <div class="download">
            <a href="http://github.com/robap/php-router/zipball/master">
                <img border="0" width="90" src="http://github.com/images/modules/download/zip.png">
            </a>
            <a href="http://github.com/robap/php-router/tarball/master">
                <img border="0" width="90" src="http://github.com/images/modules/download/tar.png">
            </a>
        </div>
        <h1>
            <a href="http://github.com/robap/php-router">php-router</a>
            <span class="small">by <a href="http://github.com/robap">robap</a></span>
        </h1>
        <div class="description">
            a php routing class
        </div>

        <p>
            The php router class is designed to help you with php routing by mapping
            so called &quot;pretty&quot; url&rsquo;s to class::methods that reside in your
            framework. It is not in itself a framework. To use it, you will need
            to create a index/bootstrap file and configure apache to route requests
            there. Included is a sample.htaccess file which you can copy into your
            apache public directory along with your index/bootstrap file.
        </p>
        <p>
            This class is abstract and as such, will not be instantiated.
            This is simply my personal preference for classes that will never
            have more than one instance during runtime.
        </p>

        <h2>Dependencies</h2>
        <p><a href="http://www.php.net/">&gt;= php 5.2.x</a></p>
        <h2>Install</h2>
        <ol>
            <li>
                Copy Router.php to some place accessible by your framework and include it.
            </li>
            <li>
                Create your index.php file and Tell apache to route requests
                through index.php (see sample.htaccess).
            </li>
            <li>
                Set your controllers path.
            </li>
            <li>
                Create your routes for your controller/actions (see the 'Adding Routes'
                section below).
            </li>
            <li>
                Call Router::matchMap(); at the end of
                your index.php file.
            </li>
        </ol>
        <h2>Routing Theory</h2>
        <p>
            There are two components to a route: the route <i>path</i> and the route
            <i>map</i>.
        </p>
        <h3>Route Paths</h3>
        <p>
            The route path is a template that represents a relative uri that you
            would like to match. It is made up of <i>static</i> or <i>dynamic</i>
            elements which are separated by a &quot;/&quot;. A preceding slash
            is not used.
        </p>
        <p>
            Static elements are hard wired parts of the path. For example,
            &quot;users&quot;, &quot;books&quot;, and &quot;parts&quot;
            are considered static elements. In order for a static element to be
            matched, that portion of the requested uri path must be exactly
            (case sensitive) the same.
        </p>
        <p>
            Dynamic elements are the portions of the path that you use to match
            different types of variables. This allows you to create Routes for
            virtually any sort of url.
            Dynamic elements are denoted by a preceding &quot;:&quot;.
            Typical dynamic elements might be &quot;:controller&quot;,
            &quot;:action&quot;, and &quot;:id&quot; but these names are completely
            arbitrary and can be anything you wish.
        </p>
        <h3>Route Maps</h3>
        <p>
            Route maps define where a matched route map should be dispatched to.
            They also define how dynamic elements will be matched.
        </p>
        <p>
            A single route map is an array made up of three associative keys:
            &quot;controller&quot;, &quot;action&quot;, and &quot;dynamic&quot;.
        </p>
        <p>
            The controller key value the name of the class to use.
            You may or may not define this as a &quot;controller&quot;
            in your framework but it really does not matter.
        </p>
        <p>
            The action key value is the name of the class method to call. The
            controller action is called statically...no instance is created.
        </p>
        <p>
            The dynamic key value is a sub array of the key value pairs that
            define your dynamic elements. This sub array is passed to your
            controller::action as an argument. It must contain keys which
            match all of the dynamic elements in your route path.
        </p>
        <p>
            Let&apos;s look at an example. Suppose you have a controller class:
        </p>
        <pre>&lt;?php
// file: partsController.php
class partsController
{
    public function show ( array $args )
    {
        //The contents of $args is passed with little or no
        // safeguarding by the Router class. Treat the contents
        // as you would all unsafe data from the user
        echo "Show part {$args[':id']}";
    }
}
?&gt;</pre>

        <p>
            You want to call &apos;partsController::show( $args )&apos;
            when the following uri path is used:
        </p>

        <pre>"/parts/show/908"</pre>

        <p>The route could look like this:</p>
        
<pre>&lt;?php
$part_route = array('/parts/show/:id' => array (
    'controller' => 'parts',
    'action'     => 'show',
    'dynamic'    => array(':id' => NULL)
));
?&gt;</pre>
        
        <p>
            Although this route would do the same thing (more on default
            routes later):
        </p>
<pre>&lt;?php
$default_route = array('/:controller/:action/:id' => array (
    'controller' => ':controller',
    'action'     => ':action',
    'dynamic'    => array(':controller' => NULL, ':action' => NULL, ':id' => NULL)
));
?&gt;</pre>
        
        <h3>Dynamic elements</h3>
        <p>
            Dynamic element values can be either NULL, which will match anything or a string
            which represents a regular expression. The regular expression is evaluated using
            php's preg_match function. So any valid regex will work. Some common regex's:
        <br /><br />
            '/^\d+$/'    : must be a number<br />
            '/^\d{4}$/'  : must be a 4 digit number<br />
            '/^abc\d+$/' : must be a string begining with 'abc' and ending in numbers<br />
        </p>

        <p>
            Also notice in the default route example above that the controller
            and action can also be dynamic. If many or all of your routes are
            laid out the same way, you can define a default route (or fewer routes)
            like this and save yourself from having to create many routes.
        </p>

        <h3>When a matching route is found</h3>

        <p>
            Matched routes are sent to a dispatch method which attempts to
            require your controller class file and call your controller::action.
            If not successful for a variety of reasons, two things happen:
            <ol>
                <li>A class error is set</li>
                <li>Your error handling class and method are called (if
                you defined and set one)</li>
            </ol>
        </p>

        <h3>When a matching route is <i>not</i> found</h3>
        <p>
            Unmatched routes will invoke these two actions:
            <ol>
                <li>A class error is set</li>
                <li>Your error handling class and method are called (if
                you defined and set one)</li>
            </ol>
        </p>

        <h2>Adding routes</h2>
        <p>
            You can add routes all at once by using the Router::autoLoadRoutes method.
            This might be the preferrable way to add routes if you have many routes
            to define.
        </p>
        <p>Example:</p>
        <pre>Router::autoLoadRoutes('/path/to/my/routes/file')</pre>
        <p>
            The other method of adding routes is to use the Router::addRoute 
            method. The first argument to addRoute is the route path and
            the second argument is the route map array. If you only have a few
            routes or even one default route, this may be easier than creating
            a routes file and using the autoLoadRoutes method.
            For example:
        </p>
        
<pre>try {
    Router::addRoute('/my/path/:year/:id', array (
        'controller' => 'controllerclass',
        'action' => 'controllerMethod',
        'dynamic' => array(':year' => '/^\d{4}$/', ':id' => '/^\d+$/')
    );
    Router::addRoute('/my/other/path/:id', array (
        'controller' => 'controllerClass',
        'action' => 'controllerMethod',
        'dynamic' => array(':id' => NULL)
    );
    //etc
} catch (Exception $e) {
    echo $e->getMessage();
}</pre>
        
        <p>
            Note that Router::addRoute() throws an Exception if the 'controller', 'action'
            and 'dynamic' keys are not present in the second argument. Even if you are creating
            a static map with no dynamic elements, the dynamic key must contain an empty array.
        </p>

        <h2>Debugging Routes</h2>
        <p>
            If you are having trouble getting routes to match up, you can
            view the class errors by:
        </p>
        <pre>&lt;?php
print_r( Router::getErrors() );
?&gt;</pre>

        <h2>Handling Errors</h2>
        <p>
            You can define an error handling class and tell the Router class
            to use it. Your class method must accept and in and a string as
            arguments. How your error class behaves is up to you. Here is
            an example:
        </p>
        <pre>&lt;?php
class UriError
{
    public function show( $error_code, $path )
    {
        $codes = array(
            400 => "Bad Request",
            404 => "Not Found",
            500 => "Internal Server Error"
        );

        header("HTTP/1.0 $error_code {$codes[$error_code]}");
        echo "$error_code {$codes[$error_code]} $path";
    }
}

Router::setErrorHandler('UriError', 'show');
?&gt;</pre>

        <h2>Setting Controllers Path</h2>
        <p>
            You will need to tell the Router class where your controllers are
            located if you plan on using the built-in dispatcher.
        </p>
        <p>
            You can optionally specify a suffix that you might be using in
            your controller name convention. For example, if your controller
            names end in 'Controller', you might specify
            a suffix of 'Controller.php'. For example:
        </p>
        <pre>&lt;?php
Router::setControllersPath('/path/to/controllers', 'Controller.php');
?&gt;</pre>

        <h2>Sample routes.php</h2>
        <p>
            The routes file (if you use one) must contain an array stored in a variable
            named "$routes" and should be in the format:
        </p>
        
<pre>&lt;?php
$routes = array (
    'foo/bar/:id' => array (
        'controller' => 'foo',
        'action'     => 'bar',
        //This map will match id's that contain numbers only
        'dynamic'       => array(':id' => '/^\d+$/')
    ),
    //You may define a catch all map. It should go last in the array.
    ':controller/:action/:id' => array (
        'controller' => ':controller',
        'action'     => ':action',
        'dynamic'       => array(':controller' => NULL, ':action' => NULL, ':id' => NULL)
    )
);
?&gt;</pre>
        
        <h2>Basic index.php Example</h2>
        
<pre>&lt;?php
include('Router.php');

Router::setControllersPath('/path/to/controllers', '.php');

try {
    Router::addRoute(':controller/:action/:id', array (
        'controller' => ':controller',
        'action'     => ':action',
        'dynamic'       => array(':controller' => NULL, ':action' => NULL, ':id' => NULL)
    ));
} catch (Exception $e) {
    echo $e;
}

Router::matchMap($_SERVER['REQUEST_URI']);
?&gt;</pre>
        
        
        <h2>Example index.php using routes.php file</h2>
        
<pre>&lt;?php
include('Router.php');

Router::setControllersPath('/path/to/controllers', '.php');

//Specify the location of the routes.php file
Router::autoLoadRoutes( '/path/to/your/routes.php' );

Router::matchMap($_SERVER['REQUEST_URI']);
?&gt;</pre>
        
        <h2>The default dispatcher</h2>
        <p>
            The default dispatcher will call your controller::action statically. If you
            want different behavior (such as creating an instance of the controller), define
            your own dispatcher and set it using the Router::setDispatcher method described
            below.
        </p>
        <p>
            The data passed by the dispatcher to your controller has had little or
            no security checking applied (however, before requiring in your
            controller, the file name and path was vetted as much as possible
            to help protect against arbitrary files from being included).
            Your should handle all data
            passed to your controllers as you would all unsafe data from users.
        </p>

        <h2>Defining your own dispatcher</h2>
        <p>
            By default, the Router::dispatch method is called by Router::matchMap whenever
            a match is found. You can define your own dispatch class and tell the Router
            class to use that class or an instance of that class instead.
        </p>
        <p>
            For example:
        </p>
        
<pre>&lt;?php
class customDispatcher
{
    /**
    * string $controller
    * string $action
    * array $dynamic
    */
    public function dispatch( $controller, $action, $dynamic )
    {
        //Your own code to dispatch the request

        //You really should do something to $controller before doing
        // something dangerous like: require("/path/to/$controller");
        // The same goes for the values in $action and $dynamic

        //The dispatch method should return TRUE if the controller::method was
        // found, FALSE if not found.
        return TRUE;
    }
}

Router::setControllersPath('/path/to/controllers');
Router::autoLoadRoutes( '/path/to/your/routes.php' );

//You can use the class statically...
Router::setDispatcher( 'customDispatcher', 'dispatch' );

//OR use an instance of the class:
$custom_dispatcher = new customDispatcher();
Router::setDispatcher( $custom_dispatcher, 'dispatch' );

Router::matchMap($_SERVER['REQUEST_URI']);
?&gt;</pre>
        

        <p>
            VERY IMPORTANT! When creating your own dispatcher, make sure you
            take proper steps to secure the code and not allow arbitrary files
            to be required in. Any dynamic elements matched will be passed to
            your custom dispatcher from the wild and unaltered.
        </p>

        <h2>Debugging</h2>

        <p>The method getErrors() is provided to help debug routing errors:</p>

        
<pre>print_r( Router::getErrors() );</pre>
       

        <h2>License</h2>
        <p>
            <a href="http://www.gnu.org/licenses/gpl.txt">GNU General Public License</a>
        </p>
        <h2>Authors</h2>
        <p>Rob Apodaca (rob.apodaca@gmail.com)
        </p>
        <h2>Contact</h2>
        <p>Rob Apodaca (rob.apodaca@gmail.com)</p>

        <h2>Download</h2>
        <p>
            You can download this project in either
            <a href="http://github.com/robap/php-router/zipball/master">zip</a>
            or
            <a href="http://github.com/robap/php-router/tarball/master">tar</a>
            formats.
        </p>
        <p>
            You can also clone the project with <a href="http://git-scm.com">Git</a>
            by running:
        <pre>$ git clone git://github.com/robap/php-router</pre>
    </p>
    <div class="footer">
        get the source code on GitHub : <a href="http://github.com/robap/php-router">robap/php-router</a>
    </div>
</div>
    <script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-9779785-1");
pageTracker._trackPageview();
} catch(err) {}</script>
</body>
</html>
