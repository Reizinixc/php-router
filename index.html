<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <title>robap/php-router @ GitHub</title>
        <link href="prettify/prettify.css" type="text/css" rel="stylesheet" />
        <script type="text/javascript" src="prettify/prettify.js"></script>
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
        <script type="text/javascript">
          $(document).ready(function() {
            $('pre').addClass('prettyprint')
            prettyPrint()
          });
        </script>
        <style type="text/css">
            body {
                margin-top: 1.0em;
                background-color: #fff;
                font-family: "helvetica";
                color: #555;
            }
            #container {
                margin: 0 auto;
                width: 700px;
            }
            h1 { font-size: 3.8em; color: #db7c1f; margin-bottom: 3px; }
            h1 .small { font-size: 0.4em; }
            h1 a { text-decoration: none }
            h2 { font-size: 1.5em; color: #db7c1f; }
            h3 { text-align: center; color: #db7c1f; }
            a { color: #db7c1f; }
            .description { font-size: 1.2em; margin-bottom: 30px; margin-top: 30px; font-style: italic;}
            .download { float: right; }
            pre { background: #e0e0e0; color: #000; padding: 15px;}
            hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
            .footer { text-align:center; padding-top:30px; font-style: italic; }
            ul li{ margin-bottom: 3px;}
            img { border: none; }
        </style>
    </head>
    <body>
    <div>
        <a href="http://github.com/robap/php-router">
            <img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" />
        </a>
    </div>
    <div id="container">
        <div class="download">
            <a href="http://github.com/robap/php-router/zipball/master">
                <img alt="zip" width="90" src="http://github.com/images/modules/download/zip.png" />
            </a>
            <a href="http://github.com/robap/php-router/tarball/master">
                <img alt="tar" width="90" src="http://github.com/images/modules/download/tar.png" />
            </a>
        </div>
        <h1>
            <a href="http://github.com/robap/php-router">php-router</a>
            <span class="small">by <a href="http://github.com/robap">robap</a></span>
        </h1>
        <div class="description">
            a php routing system
        </div>

        <h2>Introduction</h2>
        <p>
            The php router system is designed to help you with php routing by mapping
            so called &quot;pretty&quot; url&rsquo;s to class::methods that reside in your
            framework. It adopts the
            <a href="http://en.wikipedia.org/wiki/Front_Controller_pattern">
            front controller</a> pattern in which all requests are passed through
            a centralized location. That centralized location then can use this
            Routing system to pass control to some other part of your framework.
        </p>
        <p>
            It is intended that this system be portable and flexible enough to
            include in your own framework (MVC or otherwise). Hopefully, you
            find it useful.
        </p>
        <p>
            In creating a routing system, there are many ways to go about it.
            I prefer a very
            verbose method of defining routes. I want to be able to tell with
            certainty where a path is going to be routed to.
            Additionally, I shy
            away from using globals inside classes (even php's super globals).
            So, the system I'm outlining here attempts to hold to these ideals.
        </p>

        <h2>Dependencies</h2>
        <p><a href="http://www.php.net/">&gt;= php 5.2.x</a></p>
        <h2>Install</h2>
        <ol>
            <li>
                Copy the contents of src/ to some place accessible by your
                framework and include Router.php.
            </li>
            <li>
                Create your index.php file and tell apache to route requests
                through index.php (see sample.htaccess and
                <a href="http://blog.craigweston.ca/?p=18">this good description
                of how apache mod-rewrite is used for this purpose</a>).
            </li>
            <li>
                Set the path to your controller classes.
            </li>
            <li>
                Define your route or routes.
            </li>
            <li>
                Call Router::findRoute(); and pass the result to the Dispatcher
                class. A Dispatcher class is included but you can also create
                your own.
            </li>
        </ol>
        <h2>Routing Theory</h2>
        
        <p>
            Routes are added to the Router class. When the Router::findRoute()
            method is called, it searches through the defined routes and attempts
            to find a match. If a match is found, the matching route map can
            be used to determine where the request should go.
        </p>
        <p>
            A Route is comprised of two main components:
            the route <i>path</i> and the route <i>map</i>.
        </p>
        <h3>Route Paths</h3>
        <p>
            The route path is a template that represents a relative uri that you
            would like to match. It is made up of <i>static</i> or <i>dynamic</i>
            elements which are separated by a &quot;/&quot;.
        </p>
        <p>
            <i>Static</i> elements are hard wired parts of the path. The are not
            substituted with variables. They either match the map or they do not.
        </p>
        <p>
            <i>Dynamic</i> elements are the portions of the path that are
            substituted with a variable which could be anything supplied in
            the url or may have to match a regular expression.
            This allows you to create Routes for
            virtually any sort of url.
        </p>
        <h3>Route Maps</h3>
        <p>
            Route maps define how a path is to be matched and what class method
            to call when matched.
        </p>

        <h2>Defining Routes</h2>
        <p>
            Routes are defined by creating Route objects. You set the path, class,
            method, and any dynamic elements.
        </p>
<pre>
  $route = new Route( '/orders/show/:order_id' );
  $route->setMapClass( 'orders' );
  $route->setMapMethod( 'show' );
  $route->addDynamicElement( ':order_id', '^\d{5}$' );
</pre>
        <p>
            You may wish for the class and/or method to be dynamic. You can
            use regular expressions or just match anything in the path. Add as
            many routes as you need. Route matching is done in the order they
            are added. So, put the most specific routes first and the most
            generic route last.
        </p>

<pre>
  //Define matching rules to match class and method
  $route = new Route( '/:class/:method/:order_id' );
  $route->setMapClass( '^o' ); //matches class beginning with 'o'
  $route->setMapMethod( '^show_' ); //matches action beginning with 'show_'
  $route->addDynamicElement( ':order_id', '^\d{5}$' ); //matches regexp

  //Match any class and method
  $route = new Route( '/:class/:method/:order_id' );
  $route->setMapClass( ':class' ); //matches any :class
  $route->setMapMethod( ':method' ); //matches any :action
  $route->addDynamicElement( ':id', ':id' ); //matches any :id
</pre>

        <h2><a name="adding_routes">Adding routes</a></h2>
        <p>
            Add Route objects to the Router using the addRoute method.
        </p>
<pre>
  Router::addRoute($route);
</pre>

        <h2>Dispatching</h2>

        <p>
            A Dispatcher class is provided. You can also use your own method
            of dispatching the Route object returned by the Router class.
        </p>
        <p>
            Router::findRoute will return either FALSE if no match was found or
            a modified Route object. Here is how the supplied Dispatcher class can
            be used.
        </p>
<pre>
 $found_route = Router::findRoute( urldecode($_SERVER['REQUEST_URI']) );

 if( FALSE === $found_route )
 {
    //Handle unmatched route
 }
 else
 {
   try {
    Dispatcher::dispatch( $found_route );
   } catch ( badClassNameException $exception ) {
    //handle Exception
   } catch ( classFileNotFoundException $exception ) {
    //handle Exception
   } catch ( classNameNotFoundException $exception ) {
    //handle Exception
   } catch ( classMethodNotFoundException $exception ) {
    //handle Exception
   } catch ( classNotSpecifiedException $exceptione ) {
    //handle Exception
   } catch ( methodNotSpecifiedException $exception ) {
    //handle Exception
   }
}
</pre>
        <p>
            Any matched dynamic elements in the Route object are passed by the
            Dispatcher to your class/controller as an associative array.
            This passed data has had little or
            no security checking applied (however, before requiring in your
            class/controller, the file name and path was vetted as much as possible
            to help protect against arbitrary files from being included).
            You should handle all data
            passed to your classes/controllers as you would all data from users
            (as unsafe).
        </p>
        <p>
            VERY IMPORTANT! When creating your own dispatcher, make sure you
            take proper steps to secure the code and not allow arbitrary files
            to be required in. Any dynamic elements matched will be passed to
            your custom dispatcher from the wild and unaltered.
        </p>

        <h3>Setting Class/Controllers Suffix</h3>
        <p>
            You may want to define your class files and class names with
            a suffix which does not appear in your Route path. You can do so
            by using the
            Dispatcher's setSuffix method. For example, if you defined
            a class of 'orders' in your Route path and map but you actually
            want the class: 'ordersController' contained in 'ordersController.php'
            to be called, set the suffix:
        </p>
<pre>
   //Cause the file '[class]Controller.php' to be included and the class
   // '[class]Controller' to be used.
   Dispatcher::setSuffix('Controller');
</pre>
        <h3>Setting Class/Controllers Path</h3>
        <p>
            Tell the dispatcher class where to look for your class files:
        </p>
<pre>
   Dispatcher::setClassPath('/path/to/controller_classes');
</pre>
        <h2>Putting it all together</h2>
        <p>
            A very basic index.php/bootstrap file may look something like the
            following.
        </p>
        
<pre>&lt;?php

    //...Stuff before routing occurs

    //Set the include path if you wish.
    set_include_path(get_include_path() . PATH_SEPARATOR . '/path/to/php-router/src');

    //Include a PageError class which can be used later. You supply this class.
    include('PageError.php'); 
    include('Router.php');

    //Set up a 'catch all' default route and add it to the Router
    $default_route = new Route('/:class/:method/:id');
    $default_route->addDynamicElement(':class', ':class');
    $default_route->addDynamicElement(':method', ':method');
    $default_route->addDynamicElement(':id', '^\d{2}$');
    Router::addRoute($default_route);

    //Set the Dispatcher properites
    Dispatcher::setSuffix('Controller');
    Dispatcher::setClassPath('/path/to/controllers/');

    $url = urldecode($_SERVER['REQUEST_URI']);

    $found_route = Router::findRoute($url);

    if( FALSE === $found_route )
    {
        PageError::show('404', $url);
    }
    else
    {
        try {
            Dispatcher::dispatch( $found_route );
        } catch ( badClassNameException $e ) {
            PageError::show('404', $url);
        } catch ( classFileNotFoundException $e ) {
            PageError::show('404', $url);
        } catch ( classNameNotFoundException $e ) {
            PageError::show('404', $url);
        } catch ( classMethodNotFoundException $e ) {
            PageError::show('404', $url);
        } catch ( classNotSpecifiedException $e ) {
            PageError::show('404', $url);
        } catch ( methodNotSpecifiedException $e ) {
            PageError::show('404', $url);
        }
    }
?&gt;</pre>
        

        <h2>Other php url routing classes</h2>
        <ul>
            <li>
                <a href="http://allseeing-i.com/Bare-bones-Rails-style-MVC-Request-Router-for-PHP">
                        Bare-bones Rails-style MVC Request Router for PHP
                </a> A very nice php MVC router
            </li>
            <li>
                <a href="http://blog.sosedoff.com/2009/07/04/simpe-php-url-routing-controller/">
                    Simple php url routing controller
                </a>
                A well written and very lightweight routing class.
            </li>
            <li>
                <a href="http://pear.php.net/package/Net_URL_Mapper">Net URL Mapper</a>
                Light on documentation, not much to go on.
            </li>
        </ul>
        <h2>PHP Framework Routing systems</h2>
        <ul>
            <li><a href="http://codeigniter.com/user_guide/general/routing.html">
            Code Ignitor</a></li>
            <li><a href="http://docs.cakephp.nu/classes/show/Router">CakePHP</a></li>
            <li><a href="http://www.recessframework.org/page/routing-in-recess-screencast">
                Recess Framework</a></li>
            <li>
                <a href="http://framework.zend.com/manual/en/zend.controller.router.html">
                Zend Framework
                </a>
            </li>
            <li>
                <a href="http://www.symfony-project.org/book/1_2/09-Links-and-the-Routing-System">
                    Symfony
                </a>
            </li>
            <li>
                <a href="http://docs.kohanaphp.com/general/routing">
                    Kohana
                </a>
            </li>
        </ul>

        <h2>License</h2>
        <p>
            <a href="http://www.gnu.org/licenses/gpl.txt">GNU General Public License</a>
        </p>
        <h2>Authors</h2>
        <p>Rob Apodaca (rob.apodaca@gmail.com)
        </p>
        <h2>Contact</h2>
        <p>Rob Apodaca (rob.apodaca@gmail.com)</p>

        <h2>Download</h2>
        <p>
            You can download this project in either
            <a href="http://github.com/robap/php-router/zipball/master">zip</a>
            or
            <a href="http://github.com/robap/php-router/tarball/master">tar</a>
            formats.
        </p>
        <p>
            You can also clone the project with <a href="http://git-scm.com">Git</a>
            by running:
        </p>
        <pre>$ git clone git://github.com/robap/php-router</pre>
    <div class="footer">
        get the source code on GitHub : <a href="http://github.com/robap/php-router">robap/php-router</a>
    </div>
</div>
    <script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-9779785-1");
pageTracker._trackPageview();
} catch(err) {}</script>
</body>
</html>
